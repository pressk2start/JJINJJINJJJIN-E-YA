# 브랜치 비교 분석 리포트

## 비교 대상
- **브랜치1**: `claude/compare-code-versions-N0oNg` (v3.3.0, 45 커밋)
- **브랜치2**: `claude/review-latest-code-N15VE` (v3.2.7, 7 커밋)

## 핵심 차이 요약

### 진입 로직
| 기능 | 브랜치1 (v3.3.0) | 브랜치2 (v3.2.7) |
|------|-------------------|-------------------|
| 점수 계산 | Sigmoid 정규화 | 하드 임계치 |
| VWAP 활용 | 있음 | 없음 |
| BTC 리짐 필터 | storm/high_vol/normal | 없음 |
| 진입 모드 | half/confirm (probe 폐지) | probe/half/confirm 3단계 |
| 추격 처리 | 사이즈 다운 | 완전 차단 → 리테스트 |
| 스캘프/러너 분류 | 있음 (진입 시 결정) | 없음 |
| 연패 게이트 | 3~5연패 단계별 제한 | 없음 |
| 매수 방식 | 시장가 | 하이브리드 (지정가→시장가) |

### 청산 로직
| 기능 | 브랜치1 | 브랜치2 |
|------|---------|---------|
| MFE 부분익절 타겟 | 0.5~0.8% | 0.25~0.3% |
| 트레일 간격 | 0.2% (타이트) | 0.25% |
| 동적 SL | 0.4~0.6% | 별도 설정 |
| trade_type별 청산 | 스캘프→빠른익절, 러너→트레일 | 단일 경로 |
| 평단 리셋 시 상태 초기화 | 있음 | 없음 |

### 안정성/버그 수정
| 항목 | 브랜치1 | 브랜치2 |
|------|---------|---------|
| API 재시도 (429/500) | 3회 지수 백오프 | 없음 (1회) |
| streak 스레드 안전 | _STREAK_LOCK | 없음 |
| pnl_pct 단위 정규화 | 자동 변환 | 없음 (100배 과대 가능) |
| 매수직전 호가 재체크 | 있음 | 없음 |
| 텔레그램 알림 | retry=3 + 실패큐 | retry=1 |
| 전역변수 참조 | globals().get() (안전) | 직접 참조 (NameError 위험) |

## 결론: 브랜치1 권장

실전 운용 관점에서 브랜치1이 우위:
1. **API 재시도**: 매도 실패 = 금전 손실 방지
2. **pnl_pct 버그 수정**: 리스크 계산 정확성
3. **스레드 안전성**: 동시 청산 시 오작동 방지
4. **R:R 비율**: MFE 0.5~0.8% vs SL 0.4~0.6% = 합리적 (브랜치2는 수수료 차감 후 기대값 ~0)

### 브랜치1 사용 시 개선 권장사항
- DCB 비활성 코드 제거 또는 모듈 분리
- `globals().get()` → 모듈 레벨 초기화 정리
- 커밋 히스토리 squash
